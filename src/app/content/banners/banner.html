<div class="contents-header">
  <h2>Banners</h2>
</div>

<!-- Header -->
<div class="sub-header-row">
  <button class="btn-primary" (click)="openCreateModal()">
    New Banner
  </button>
</div>

<!-- Loading / Error -->
<div *ngIf="isLoading">Loading banners...</div>
<div *ngIf="error" class="error">{{ error }}</div>

<!-- Empty -->
<div *ngIf="!isLoading && banners.length === 0">
  No banners found.
</div>

<!-- Banners Grid -->
<div class="banners-grid" *ngIf="!isLoading && banners.length > 0">
  <div class="banner-card" *ngFor="let b of banners">

    <img [src]="b.imageUrl" alt="Banner" class="banner-img" />

    <h3 class="banner-title">{{ b.title }}</h3>

    <p *ngIf="b.publishAt" class="banner-date">
      Published: {{ b.publishAt | date:'MMM d, y, h:mm a' }}
    </p>

    <p *ngIf="b.expireAt" class="banner-date">
      Expires: {{ b.expireAt | date:'MMM d, y, h:mm a' }}
    </p>

    <p class="banner-preview" *ngIf="b.content">
      {{ stripHtml(b.content) }}
    </p>

    <div class="banner-footer">
      <span class="status-pill" [ngClass]="getStatusClass(b.status)">
        {{ b.status | titlecase }}
      </span>

      <div class="card-actions">
        <button (click)="openEditModal(b)">Edit</button>
        <button (click)="openPreviewModal(b)">Preview</button>
      </div>
    </div>

  </div>
</div>

<!-- CREATE / EDIT MODAL -->
<div class="modal-backdrop" *ngIf="showCreateModal" (click)="closeCreateModal()"></div>

<div class="modal" *ngIf="showCreateModal">
  <form class="modal-content" (ngSubmit)="saveBanner()" novalidate>

    <h3>{{ editingBannerId ? 'Edit Banner' : 'New Banner' }}</h3>

    <label>
      Title
      <input type="text" [(ngModel)]="newBanner.title" name="title" required />
    </label>

    <label>
      Image URL
      <input type="text" [(ngModel)]="newBanner.imageUrl" name="imageUrl" required />
    </label>

    <label>
      Link (optional)
      <input type="text" [(ngModel)]="newBanner.link" name="link" />
    </label>

    <label>
      Status
      <select [(ngModel)]="newBanner.status" name="status" required>
        <option value="draft">Draft</option>
        <option value="published">Published</option>
      </select>
    </label>

    <!-- PUBLISH DATE -->
    <label>Publish Date</label>
    <div class="datetime-row">

      <mat-form-field appearance="outline" class="date-field">
        <mat-label>Date</mat-label>
        <input
          matInput
          [matDatepicker]="publishPicker"
          [(ngModel)]="publishDate"
          name="publishDate"
          required
        />
        <mat-datepicker-toggle matSuffix [for]="publishPicker"></mat-datepicker-toggle>
        <mat-datepicker #publishPicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="time-field">
        <mat-label>Time</mat-label>
        <select matNativeControl [(ngModel)]="publishTime" name="publishTime" required>
          <option *ngFor="let t of timeOptions" [value]="t">
            {{ t }}
          </option>
        </select>
      </mat-form-field>

    </div>

    <!-- EXPIRE DATE -->
    <label>Expire Date</label>
    <div class="datetime-row">

      <mat-form-field appearance="outline" class="date-field">
        <mat-label>Date</mat-label>
        <input
          matInput
          [matDatepicker]="expirePicker"
          [(ngModel)]="expireDate"
          name="expireDate"
          required
        />
        <mat-datepicker-toggle matSuffix [for]="expirePicker"></mat-datepicker-toggle>
        <mat-datepicker #expirePicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="time-field">
        <mat-label>Time</mat-label>
        <select matNativeControl [(ngModel)]="expireTime" name="expireTime" required>
          <option *ngFor="let t of timeOptions" [value]="t">
            {{ t }}
          </option>
        </select>
      </mat-form-field>

    </div>

    <!-- CONTENT EDITOR -->
    <label>
      Content
      <angular-editor
        [(ngModel)]="newBanner.content"
        name="content"
        [config]="editorConfig"
        (focus)="onEditorFocus($event)"
      ></angular-editor>
    </label>

    <!-- Actions -->
    <div class="modal-actions">

      <button
        type="button"
        class="btn-danger"
        *ngIf="editingBannerId"
        (click)="deleteBanner()"
        [disabled]="isSaving || isDeleting"
      >
        {{ isDeleting ? 'Deleting...' : 'Delete' }}
      </button>

      <span class="spacer"></span>

      <button type="button" (click)="closeCreateModal()" [disabled]="isSaving || isDeleting">
        Cancel
      </button>

      <button type="submit" [disabled]="isSaving || isDeleting">
        {{ isSaving ? 'Saving...' : (editingBannerId ? 'Update Banner' : 'Save Banner') }}
      </button>

    </div>

  </form>
</div>

<!-- PREVIEW MODAL -->
<div class="modal-backdrop" *ngIf="showPreviewModal" (click)="closePreviewModal()"></div>

<div class="modal" *ngIf="showPreviewModal">
  <div class="modal-content preview-modal">

    <button class="modal-close-x" type="button" (click)="closePreviewModal()">✕</button>

    <h3>{{ previewBanner?.title }}</h3>

    <p>
      <strong>Status:</strong> {{ previewBanner?.status }}
      <span *ngIf="previewBanner?.publishAt">
        · Published: {{ previewBanner?.publishAt | date:'MMM d, y, h:mm a' }}
      </span>
      <span *ngIf="previewBanner?.expireAt">
        · Expires: {{ previewBanner?.expireAt | date:'MMM d, y, h:mm a' }}
      </span>
    </p>

    <div *ngIf="previewBanner?.imageUrl" class="preview-image-wrapper">
      <img [src]="previewBanner?.imageUrl" class="preview-image" />
    </div>

    <div class="preview-content" [innerHTML]="previewBanner?.content"></div>

    <div class="modal-actions">
      <button type="button" class="modal-close-btn" (click)="closePreviewModal()">
        Close
      </button>
    </div>

  </div>
</div>
